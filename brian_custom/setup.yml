---
user_message: |
  - Be sure to update the 'activation_key' and 'org_id' extra variables for 'LINUX / Register'. https://access.redhat.com/management/activation_keys
  - Update Credential for Insights Inventory with Red Hat account.
  - Add variables for system_roles. https://console.redhat.com/ansible/automation-hub/repo/published/redhat/rhel_system_roles
controller_components:
  - projects  
  - credential_types
  - credentials
  # - applications
  - settings
  # - inventories
  # - hosts
  # - inventory_sources
  - execution_environments
  - job_templates
  - workflow_job_templates
  - job_launch
  # - project_update

controller_projects:
  - name: Cloud Deploy
    organization: Default
    scm_type: git
    scm_url: 'https://github.com/brianstinehart/Cloud-Deploy.git'

controller_credential_types:
  - name: "ServiceNow"
    kind: "cloud"
    inputs:
      fields:
        - id: username
          type: string
          label: Username
        - id: password
          type: string
          label: Password
          secret: true
        - id: instance
          type: string
          label: Instance
      required:
        - username
        - password
        - instance
    injectors:
      extra_vars:
        snow_username: !unsafe '{{ username }}'
        snow_password: !unsafe '{{ password }}'
        snow_instance: !unsafe '{{ instance }}'

  - name: "URI"
    kind: "cloud"
    inputs:
      fields:
        - id: uri_user
          type: string
          label: URI Username
        - id: uri_password
          type: string
          label: URI Password
          secret: true
        - id: controller_url_prefix
          type: string
          label: Controller URI Prefix
        - id: controller_url_suffix
          type: string
          label: Controller URI Suffix
      required:
        - uri_user
        - uri_password
        - controller_url_prefix
        - controller_url_suffix
    injectors:
      extra_vars:
        uri_user: '{{ uri_user }}'
        uri_password: '{{ uri_password }}'
        controller_url_prefix: '{{ controller_url_prefix }}'
        controller_url_suffix: '{{ controller_url_suffix }}'

controller_credentials:
  - name: ServiceNow Dev
    credential_type: ServiceNow
    organization: Default
    inputs:
      username: "{{ username }}"
      password: "{{ password }}"
      instance: "{{ instance }}"

  - name: URI Credential
    credential_type: URI
    organization: Default
    inputs:
      uri_user: '{{ uri_user }}'
      uri_password: '{{ uri_password }}'
      controller_url_prefix: '{{ controller_url_prefix }}'
      controller_url_suffix: '{{ controller_url_suffix }}'

# controller_applications:
#   - name: Brian ServiceNow Dev
#     description: "{{ instance }}"
#     organization: "Default"
#     authorization_grant_type: "authorization-code"
#     redirect_uris: "https://{{ instance }}.service-now.com/oauth_redirect.do"
#     client_type: "confidential"

controller_settings:
  - name: ALLOW_OAUTH2_FOR_EXTERNAL_USERS
    value: true

# controller_inventories:
#   - name: local-demo
#     organization: Default

# controller_hosts:
#   - name: localhost
#     inventory: local-demo
#     variables:
#       ansible_connection: local

controller_execution_environments:
  - name: "ServiceNow EE"
    image: quay.io/rhbs/aap-ee

controller_templates:
  - name: "ServiceNow Notification"
    job_type: run
    inventory: "Demo Inventory"
    project: "Cloud Deploy"
    playbook: "playbooks/servicenow/snow_notify.yml"
    execution_environment: ServiceNow EE
    credentials:
    - "ServiceNow Dev"
    extra_vars:
      snow_note: "This request has been received by Ansible Automation Platform. Please monitor Activity Stream for progress."
      ansible_python_interpreter: /usr/bin/python3

  - name: "ServiceNow Create Incident"
    job_type: run
    inventory: "Demo Inventory"
    project: "Cloud Deploy"
    playbook: "playbooks/servicenow/snow_create_incident.yml"
    execution_environment: ServiceNow EE
    credentials:
    - "ServiceNow Dev"
    extra_vars:
      ansible_python_interpreter: /usr/bin/python3

  - name: "ServiceNow Create Change Request"
    job_type: run
    inventory: "Demo Inventory"
    project: "Cloud Deploy"
    playbook: "playbooks/servicenow/snow_create_change_request.yml"
    execution_environment: ServiceNow EE
    credentials:
    - "ServiceNow Dev"
    extra_vars:
      ansible_python_interpreter: /usr/bin/python3
      snow_host: https://dev97360.service-now.com/

  - name: "ServiceNow Close Change Request"
    job_type: run
    inventory: "Demo Inventory"
    project: "Cloud Deploy"
    playbook: "playbooks/servicenow/snow_close_change_request.yml"
    execution_environment: ServiceNow EE
    credentials:
    - "ServiceNow Dev"
    extra_vars:
      ansible_python_interpreter: /usr/bin/python3
      snow_host: https://dev97360.service-now.com/
    survey_enabled: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: Change Request Number
          question_description: ServiceNow Incident Number
          required: true
          type: text
          variable: inc_number
          min: 0
          max: 1024
          default: ''
          choices: ''
          new_question: true
        - question_name: Resolution notes
          question_description: ServiceNow Resolution Notes
          required: true
          type: text
          variable: close_notes
          min: 0
          max: 1024
          default: ''
          choices: ''
          new_question: true

  - name: "ServiceNow Close Incident"
    job_type: run
    inventory: "Demo Inventory"
    project: "Cloud Deploy"
    playbook: "playbooks/servicenow/snow_close_incident.yml"
    execution_environment: ServiceNow EE
    credentials:
    - "ServiceNow Dev"
    extra_vars:
      ansible_python_interpreter: /usr/bin/python3
    survey_enabled: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: Incident Number
          question_description: ServiceNow Incident Number
          required: true
          type: text
          variable: inc_number
          min: 0
          max: 1024
          default: ''
          choices: ''
          new_question: true
        - question_name: Resolution notes
          question_description: ServiceNow Resolution Notes
          required: true
          type: text
          variable: close_notes
          min: 0
          max: 1024
          default: ''
          choices: ''
          new_question: true

  - name: "ServiceNow Setup"
    job_type: run
    inventory: "Demo Inventory"
    project: "Cloud Deploy"
    playbook: "playbooks/servicenow/snow_setup.yml"
    execution_environment: ServiceNow EE
    credentials:
    - "ServiceNow Dev"
    - "URI Credential"
    extra_vars:
      ansible_python_interpreter: /usr/bin/python3
      demo: brian_custom

  # - name: "Brian ServiceNow Setup"
  #   state: absent

# controller_workflows:
#   - name: "Deploy App on Pre-Prod (AWS)"
#     survey_enabled: true
#     survey_spec:
#       name: ''
#       description: ''
#       spec:
#         - question_name: ServiceNow Request Number
#           question_description: ServiceNow Request Number
#           required: true
#           type: text
#           variable: snow_request
#           min: 0
#           max: 1024
#           default: ''
#           choices: ''
#           new_question: true

controller_launch_jobs:
  - name: ServiceNow Setup
